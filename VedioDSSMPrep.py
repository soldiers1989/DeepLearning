import sys
from operator import add

from pyspark import SparkContext

ctypemap = { 0:1,
    1:2,
    2:3,
    3:4,
    4:5,
    5:6,
    6:7,
    9:8,
    10:9,
    22:10,
    23:11,
    24:12,
    25:13,
    26:14,
    27:15,
    28:16,
    29:17,
    30:18,
    31:19,
    40:20,
    41:21,
    42:22,
    43:23,
    45:24,
    46:25,
    52:26,
    60:27,
    103:28,
    104:29,
    105:30,
    106:31 }

class_id = { 1494463:1,
    1494422:2,
    1494421:3,
    1494426:4,
    1494424:5,
    1494423:6,
    1494464:7,
    1496639:8,
    1494428:9,
    1494427:10,
    1494429:11,
    1494449:12,
    1494437:13,
    1494438:14,
    1494439:15,
    1494440:16,
    1494456:17,
    1494501:18,
    1494503:19,
    1494504:20,
    1494560:21,
    1494480:22,
    1494510:23,
    1494544:24,
    1494476:25,
    1494539:26,
    1494450:27,
    1494441:28,
    1538938:29,
    1538931:30,
    1538932:31,
    1538933:32,
    1538934:33,
    1538935:34,
    1538936:35,
    1497092:36,
    1497094:37,
    1497093:38,
    1494444:39,
    1494452:40,
    1494592:41,
    1497226:42,
    1494541:43,
    1494561:44,
    1494550:45,
    1494519:46,
    1494552:47,
    1494551:48,
    1497217:49,
    1494559:50,
    1494446:51,
    1497089:52,
    1497090:53,
    1494484:54,
    1494483:55,
    1497091:56,
    1528260:57,
    1528261:58,
    1494470:59,
    1494430:60,
    1494433:61,
    1494436:62,
    1494434:63,
    1494435:64,
    1528255:65,
    1528256:66,
    1528257:67,
    1543612:68,
    1543613:69,
    1494468:70,
    1496652:71,
    1494578:72,
    1494445:73,
    1496651:74,
    1519794:75,
    1519793:76,
    1519792:77,
    1494451:78,
    1494487:79,
    1496637:80,
    1494517:81,
    1496638:82,
    1494461:83,
    1494523:84,
    1494570:85,
    1494497:86,
    1496633:87,
    1494589:88,
    1494557:89,
    1494547:90,
    1494546:91,
    1494469:92,
    1494488:93,
    1494493:94,
    1494513:95,
    1494545:96,
    1494525:97,
    1494554:98,
    1494478:99,
    1494575:100,
    1494590:101,
    1494522:102,
    1494586:103,
    1529008:104,
    1494448:105,
    1494492:106,
    1494491:107,
    1494540:108,
    1494521:109,
    1528271:110,
    1528266:111,
    1528267:112,
    1528268:113,
    1528269:114,
    1494462:115,
    1496635:116,
    1494473:117,
    1494534:118,
    1494520:119,
    1494485:120,
    1494482:121,
    1494486:122,
    1494515:123,
    1494555:124,
    1494591:125,
    1528258:126,
    1528259:127,
    1494526:128,
    1494458:129,
    1494533:130,
    1494532:131,
    1494572:132,
    1494549:133,
    1494558:134,
    1494472:135,
    1494567:136,
    1494459:137,
    1494511:138,
    1494500:139,
    1494531:140,
    1494582:141,
    1496636:142,
    1494457:143,
    1494529:144,
    1494530:145,
    1528265:146,
    1494460:147,
    1494528:148,
    1494584:149,
    1494543:150,
    1494556:151,
    1494553:152,
    1494588:153,
    1528263:154,
    1494542:155,
    1494467:156,
    1538939:157,
    1538940:158,
    1538941:159,
    1538942:160,
    1538943:161,
    1538945:162,
    1538944:163,
    1494453:164,
    1494548:165,
    1494489:166,
    1494574:167,
    1494496:168,
    1494524:169,
    1494538:170,
    1494481:171,
    1494508:172,
    1528264:173,
    1494455:174,
    1494585:175,
    1494580:176,
    1494514:177,
    1494498:178,
    1528262:179,
    1494454:180,
    1494583:181,
    1494477:182,
    1494535:183,
    1494527:184,
    1494465:185,
    1494563:186,
    1494509:187,
    1494566:188,
    1494562:189,
    1494466:190,
    1494536:191,
    1494475:192,
    1494565:193,
    1494564:194,
    1494579:195,
    1494447:196,
    1494518:197,
    1494494:198,
    1494576:199,
    1494490:200,
    1538937:201,
    1543614:202 }

def seg_age(age):
  agebucket = 0
  if age > 12 and age <= 18:
    agebucket = 1
  elif age > 18 and age <= 22:
    agebucket = 2
  elif age > 22 and age <= 25:
    agebucket = 3
  elif age > 25 and age <= 28:
    agebucket = 4
  elif age > 28 and age <= 35:
    agebucket = 5
  elif age > 35 and age <= 40:
    agebucket = 6
  elif age > 40 and age <= 49:
    agebucket = 7
  elif age > 49 and age <= 60:
    agebucket = 8
  elif age > 60 and age <= 80:
    agebucket = 9
  return agebucket

def seg_grade(grade):
  gradebucket = 0
  if grade >= 1 and grade <= 3:
    gradebucket = 1
  elif grade >= 4 and grade <= 6:
    gradebucket = 2
  return gradebucket

def seg_gender(gender):
  genderbucket = 0
  if gender == 1:
    genderbucket = 1
  elif gender == 2:
    genderbucket = 2
  return genderbucket

if __name__ == "__main__":
  sc = SparkContext(appName="PythonWordCount")
  lines = sc.textFile('sample.bincai.txt')
  count = lines.count()
  print(count)
  counts = lines.flatMap(lambda x: x.split(' ')) \
    .map(lambda x: (x, 1)) \
    .reduceByKey(add)
  output = counts.collect()
  for (word, count) in output:
    print("%s: %i" % (word, count))

  sc.stop()